#!/usr/bin/env python

import requests

class API:
  def __init__(self,pfx,sfx='',
{{#each yaml.securitySchemes}}
{{#oauth_2_0}}
        # headers
{{#each describedBy.headers}}
        {{@key}}=None,
{{/each}}
        # queryParameters
{{#each describedBy.queryParameters}}
        {{@key}}=None,
{{/each}}
{{/oauth_2_0}}
{{/each}}
):
{{#each yaml.securitySchemes}}

{{#basic}}
    # Basic authentication NYI (not yet implemented)
    sys.stderr.write("Basic authentication NYI (not yet implemented)")
{{/basic}}

{{#oauth_1_0}}
    # OAuth1.0 authentication NYI (not yet implemented)
    sys.stderr.write("OAuth1.0 authentication NYI (not yet implemented)")
{{/oauth_1_0}}

{{#oauth_2_0}}
    #typ = "{{type}}"
    #describedBy = {{{describedBy}}}
    #description = """{{{description}}}"""
    #settings = {{{settings}}}
{{/oauth_2_0}}

{{/each}}



    self.pfx=pfx
    self.sfx=sfx
    pass
{{#each d}}
  def rpc{{flat_path}}_{{method}}(self,
    {{#each parmsx.uri}}{{key_name}},{{/each}}
    {{#each parmsx.query}}{{key_name}},{{/each}}
    {{#each parmsx.form}}{{key_name}},{{/each}}):
    path='{{path}}'
    path2=path
    query_dict={}
    form_dict={}
{{#each parmsx.uri}}
    # u p {{{.}}}
    path2 = path2.replace('{'+'{{key_name}}'+'}',{{key_name}})

{{/each}}
{{#each parmsx.query}}
    # q p {{{.}}}
    query_dict['{{key_name}}'] = {{key_name}}

{{/each}}
{{#each parmsx.form}}
    # f p {{{.}}}
    form_dict['{{key_name}}'] = {{key_name}}

{{/each}}
    return requests.{{method}}(path2,params=query_dict,data=form_dict)
{{/each}}

if __name__=='__main__':
   import os
   access_token=os.environ.get('ACCESS_TOKEN','TOK')
   api=API('https://api.instagram.com/v1/','?access_token='+access_token)

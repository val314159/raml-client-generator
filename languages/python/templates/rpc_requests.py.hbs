#!/usr/bin/python

import requests,json

def wrongType(var,typ):
    try:
        if typ=='integer':
            int(var)
        elif typ=='number':
            float(var)
            pass
        return False
    except:
        return True
    pass

true,false=True,False

{{#each allMethods}}
def rpc{{flatPath resource}}_{{method}}(self,
  {{#each resource.uriParameters}}{{displayName}}=None,{{/each}} #uri
  {{#each queryParameters}}{{@key}}=None,{{/each}} # query
  {{#each body}}{{#each formParameters}}{{@key}}=None,{{/each}}{{/each}} # form
):
   """
  {{{description}}}
  """
   path='{{fullPath resource}}'

   uri=path
{{#each resource.uriList}}
   uri=uri.replace('{'+'{{displayName}}'+'}',{{displayName}})
{{/each}}

    ###
    #  put field validation here
    ###
{{#each resource.uriList}}
    if bool({{required}}) and {{displayName}} is None:
      raise "MISSING"
    if wrongType({{displayName}},'{{type}}'):
      raise "WRONGTYPE"
{{/each}}

{{#each queryParameters}}
    if bool({{required}}) and {{displayName}} is None:
      raise "MISSING"
    if wrongType({{displayName}},'{{type}}'):
      raise "WRONGTYPE"
{{/each}}

{{#each body}}
{{#each formParameters}}
    if bool({{required}}) and {{displayName}} is None:
      raise "MISSING"
    if wrongType({{displayName}},'{{type}}'):
      raise "WRONGTYPE"
{{/each}}
{{/each}}
    ###
    #  end field validation here
    ###



   query={}
{{#each queryParameters}}
   query['{{@key}}']={{@key}}
{{/each}}

   qstr='&'.join([(str(k)+'='+str(v)) for k,v in query.iteritems()])
   if qstr: qstr='?'+qstr
   if '{{method}}' in ('post','put','patch'):
       form={}
{{#each body}}{{#each formParameters}}
       form['{{@key}}']={{@key}}
{{/each}}{{/each}}
       body = urllib.urlencode(form)
       #return requests.{{method}}(url+qstr,data=form)
   else:
       body = None
       pass#return requests.{{method}}(url+qstr)
   return requests.{{method}}(url+qstr,data=body)

{{/each}}

def main():
  print "main"
  pass

if __name__=='__main__': main()
